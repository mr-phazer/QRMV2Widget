name: Tests

on:
    push:
        branches: [ "*" ]

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [windows-latest]
        include:
        - {os: windows-latest, TARGET: x86_64-pc-windows-msvc}

    steps:
      - uses: actions/checkout@v2
      - uses: ilammy/msvc-dev-cmd@v1

      - name: Install Qt
        uses: jurplel/install-qt-action@v2

      - name: Setup vars
        run: |
          echo "QtMsBuild=D:\a\QRMV2Widget\QRMV2Widget\QtMsBuild" >> $env:GITHUB_ENV
          echo "QtToolsPath=D:\a\QRMV2Widget\Qt\5.15.2\msvc2019_64\bin" >> $env:GITHUB_ENV
          echo "INCLUDE=D:\a\QRMV2Widget\Qt\5.15.2\msvc2019_64\include" >> $env:GITHUB_ENV
          echo "LIB=D:\a\QRMV2Widget\Qt\5.15.2\msvc2019_64\lib\Qt5Widgets.lib;D:\a\QRMV2Widget\Qt\5.15.2\msvc2019_64\lib\Qt5Gui.lib;D:\a\QRMV2Widget\Qt\5.15.2\msvc2019_64\lib\Qt5Core.lib;D:\a\QRMV2Widget\Qt\5.15.2\msvc2019_64\lib\qtmain.lib;" >> $env:GITHUB_ENV

      - name: Compile the lib
        run: |
          mkdir D:\a\QRMV2Widget\QRMV2Widget\QtRMV2Widget\x64\
          mkdir D:\a\QRMV2Widget\QRMV2Widget\QtRMV2Widget\x64\Release\
          msbuild SystemLib\SystemLib.vcxproj /t:Build /p:Configuration=Release /p:Platform=x64 /p:OutDir=D:\output
          cp D:\output\SystemLib.lib D:\a\QRMV2Widget\QRMV2Widget\QtRMV2Widget\x64\Release\
          msbuild ImporterLib\ImporterLib.vcxproj /t:Build /p:Configuration=Release /p:Platform=x64 /p:OutDir=D:\output
          cp D:\output\ImporterLib.lib D:\a\QRMV2Widget\QRMV2Widget\QtRMV2Widget\x64\Release\
          msbuild QtRMV2Widget\QtRMV2Widget.vcxproj /t:Build /p:Configuration=Release /p:Platform=x64 /p:OutDir=D:\output
